; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
board_build.arduino.ldscript = esp32_out.ld
upload_speed = 460800
monitor_dtr = 0
monitor_rts = 0

; PSRAM 활성화 (ESP32에 PSRAM이 있는 경우 +4MB RAM)
board_build.partitions = huge_app.csv
build_flags = 
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -Os                    ; 크기 최적화 (메모리 절약)
    -DCORE_DEBUG_LEVEL=0   ; 디버그 로그 비활성화

; (No per-env exclusion here — keep normal esp32dev build including main files)

; Include all sources but exclude the OTA tester from the normal esp32dev build
build_src_filter = +<*> -<ota_only.cpp>

; === OTA 업로드 설정 (WiFi 연결 후 사용) ===
; 아래 주석을 해제하면 USB 대신 WiFi로 업로드됩니다

upload_protocol = espota
upload_port = DryerESP32.local
;upload_port = 192.168.0.93
upload_flags = --auth=1234

; On Windows the Arduino IDE's espota.exe works reliably — use it here
; Replace IP or auth as needed. This overrides PlatformIO's python espota uploader.
upload_command = C:\Users\thpark\AppData\Local\Arduino15\packages\esp32\hardware\esp32\3.3.4\tools\espota.exe -r -i DryerESP32.local -p 3232 --auth=1234 -f .pio\build\esp32dev\firmware.bin

; MQTT 라이브러리
lib_deps = 
    knolleary/PubSubClient@^2.8

; --- OTA-only tester environment (builds only src/ota_only.cpp) ---
[env:ota]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
board_build.arduino.ldscript = esp32_out.ld
upload_speed = 460800
monitor_dtr = 0
monitor_rts = 0
; same build flags as main env
board_build.partitions = huge_app.csv
build_flags = 
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -Os
    -DCORE_DEBUG_LEVEL=0
; Build only the OTA tester source in this env
build_src_filter = +<ota_only.cpp>
; Use espota for OTA uploads from this environment (when uploading to device IP)
upload_protocol = espota
upload_flags = --auth=1234
upload_port = DryerESP32.local
